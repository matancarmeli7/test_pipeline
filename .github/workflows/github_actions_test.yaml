on:
  push:
    branches:
    - main
jobs:
  test-csi:
    name: "matan test CI"
    runs-on: ubuntu-latest
    steps:
      #- name: create kind cluster 2
      #  run: |
      #    ansible-pull -U https://github.com/operator-framework/operator-test-playbooks -C master -i localhost, -e ansible_connection=local -e run_upstream=true -e run_remove_catalog_repo=false upstream/local.yml -e run_prepare_catalog_repo_upstream=false --tags reset,kind,kubectl,docker,base
      - name: Checkout code
        uses: actions/checkout@v2
      - name: kiwi / Full operator test
        env:
          OP_TEST_SCRIPT_URL: "https://raw.githubusercontent.com/operator-framework/operator-test-playbooks/master/upstream/test/test.sh"
        run: |
          bash <(curl -sL $OP_TEST_SCRIPT_URL) kiwi "deploy/olm-catalog/ibm-block-csi-operator-community/1.5.0"
      #- name: check cluster
      #  run: |
      #    kubectl apply -f https://raw.githubusercontent.com/IBM/ibm-block-csi-operator/master/deploy/installer/generated/ibm-block-csi-operator.yaml
      #    kubectl apply -f https://raw.githubusercontent.com/IBM/ibm-block-csi-operator/master/deploy/crds/csi.ibm.com_v1_ibmblockcsi_cr.yaml
      #    kubectl get pods -A
      - name: check cluster
        run: |
          kubectl get pods -A
